#!/bin/bash
function _start
{
    echo  "starting application...."
    # Run webpack watcher
    cd server/ && npm run watch &
    # Run python server
    python ./run.py &
}

function _unset_envs
{
    unset $(cat .env | egrep -o '(^[^#])(\w+?)' | xargs)
}

function _export_envs()
{
    file_path=$1
    if [ ! $file_path ]; then
        echo "please provide the file path to the .env file"
        exit
    fi

    envs=$(cat $file_path | egrep '^[^#]' | xargs) # get all non-comment env variables
    export $envs
}

function _stop
{
    echo  "Stop application...."
    pkill -f "npm|node|python"
}

: '
    NAME

      --  app [start|stop]

    DESCRIPTION
        starts/stops the `webpack` background watch and the python web server.
'

case "$1" in
    start)
        _start
        ;;
    stop)
        _stop
        ;;
    unset_envs)
        _unset_envs
        ;;
    export_envs)
        _export_envs $2 
        ;;
    *)
        echo "Usage: app  {start|stop|unset_envs|export_envs}"
esac
